<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Internet Speed Test - MultiTools</title>
    <link rel="stylesheet" href="../assets/css/style.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .speed-display {
            font-size: 2.5em;
            font-weight: bold;
            color: #dc3545;
        }
        .progress-custom {
            height: 25px;
            border-radius: 15px;
        }
        .test-status {
            font-size: 1.2em;
            font-weight: bold;
        }
    </style>
</head>
<body class="bg-dark text-light">
  <!-- Sticky Side Ads -->
  <div class="sticky-side-ad left">
    <div class="ad-placeholder">AdSense Left</div>
  </div>
  <div class="sticky-side-ad right">
    <div class="ad-placeholder">AdSense Right</div>
  </div>
  <div id="header"></div>
  <div class="container py-4">
    <div class="mb-3">
      <a href="../index.html" class="btn btn-outline-danger">&larr; Back to Home</a>
    </div>
    <h1 class="text-danger mb-4">Internet Speed Test</h1>
    <div class="row justify-content-center">
      <div class="col-md-10 col-lg-8">
        <div class="card bg-black border-danger mb-4">
          <div class="card-body">
            <div class="alert alert-info bg-dark border-danger">
              <i class="fas fa-info-circle me-2"></i>
              <strong>Note:</strong> This speed test runs in your browser and may not be as accurate as dedicated speed test services.
            </div>
            <div class="text-center mb-4">
              <button class="btn btn-danger btn-lg" onclick="startSpeedTest()" id="startBtn">
                <i class="fas fa-play me-2"></i>Start Speed Test
              </button>
            </div>
            <div id="testSection" style="display: none;">
              <div class="row">
                <div class="col-md-6">
                  <div class="card bg-dark border-danger">
                    <div class="card-body text-center">
                      <h5 class="text-light">Download Speed</h5>
                      <div class="speed-display" id="downloadSpeed">--</div>
                      <small class="text-muted">Mbps</small>
                    </div>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="card bg-dark border-danger">
                    <div class="card-body text-center">
                      <h5 class="text-light">Upload Speed</h5>
                      <div class="speed-display" id="uploadSpeed">--</div>
                      <small class="text-muted">Mbps</small>
                    </div>
                  </div>
                </div>
              </div>
              <div class="mt-4">
                <div class="progress progress-custom">
                  <div class="progress-bar progress-bar-striped progress-bar-animated bg-danger" id="progressBar" style="width: 0%"></div>
                </div>
                <div class="text-center mt-2">
                  <span class="test-status text-light" id="testStatus">Ready to test</span>
                </div>
              </div>
            </div>
            <div id="resultsSection" style="display: none;">
              <h5 class="text-center mb-3 text-light">Test Results</h5>
              <div class="row">
                <div class="col-md-4">
                  <div class="card bg-dark border-danger text-center">
                    <div class="card-body">
                      <h6 class="text-light">Download</h6>
                      <div class="speed-display" id="finalDownload">--</div>
                      <small class="text-muted">Mbps</small>
                    </div>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="card bg-dark border-danger text-center">
                    <div class="card-body">
                      <h6 class="text-light">Upload</h6>
                      <div class="speed-display" id="finalUpload">--</div>
                      <small class="text-muted">Mbps</small>
                    </div>
                  </div>
                </div>
                <div class="col-md-4">
                  <div class="card bg-dark border-danger text-center">
                    <div class="card-body">
                      <h6 class="text-light">Ping</h6>
                      <div class="speed-display" id="pingResult">--</div>
                      <small class="text-muted">ms</small>
                    </div>
                  </div>
                </div>
              </div>
              <div class="text-center mt-3">
                <button class="btn btn-danger" onclick="startSpeedTest()">
                  <i class="fas fa-redo me-2"></i>Test Again
                </button>
              </div>
            </div>
          </div>
        </div>
        <!-- Speed Guidelines -->
        <div class="card bg-dark border-danger mb-4">
          <div class="card-header text-danger">
            <h5><i class="fas fa-lightbulb me-2"></i>Speed Guidelines</h5>
          </div>
          <div class="card-body">
            <div class="row">
              <div class="col-md-6">
                <h6 class="text-danger">Download Speeds:</h6>
                <ul class="text-light">
                  <li><strong>1-5 Mbps:</strong> Basic web browsing</li>
                  <li><strong>5-25 Mbps:</strong> HD video streaming</li>
                  <li><strong>25-100 Mbps:</strong> 4K streaming, gaming</li>
                  <li><strong>100+ Mbps:</strong> Multiple devices, heavy usage</li>
                </ul>
              </div>
              <div class="col-md-6">
                <h6 class="text-danger">Upload Speeds:</h6>
                <ul class="text-light">
                  <li><strong>1-5 Mbps:</strong> Basic file sharing</li>
                  <li><strong>5-10 Mbps:</strong> Video calls, cloud backup</li>
                  <li><strong>10-25 Mbps:</strong> Live streaming</li>
                  <li><strong>25+ Mbps:</strong> Professional streaming</li>
                </ul>
              </div>
            </div>
          </div>
        </div>
        <!-- Important Notes -->
        <div class="card bg-dark border-danger mb-4">
          <div class="card-header text-danger">
            <h5><i class="fas fa-exclamation-triangle me-2"></i>Important Notes</h5>
          </div>
          <div class="card-body">
            <ul class="text-light">
              <li>Results may vary based on network conditions</li>
              <li>Close other applications for more accurate results</li>
              <li>Test multiple times for better accuracy</li>
              <li>Contact your ISP if speeds are consistently low</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div id="footer"></div>
  <script src="../assets/js/include.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    let testInProgress = false;
    let downloadSpeed = 0;
    let uploadSpeed = 0;
    let pingTime = 0;

    function startSpeedTest() {
        if (testInProgress) return;
        
        testInProgress = true;
        document.getElementById('startBtn').disabled = true;
        document.getElementById('testSection').style.display = 'block';
        document.getElementById('resultsSection').style.display = 'none';
        
        resetDisplays();
        runSpeedTest();
    }

    function resetDisplays() {
        document.getElementById('downloadSpeed').textContent = '--';
        document.getElementById('uploadSpeed').textContent = '--';
        document.getElementById('progressBar').style.width = '0%';
        document.getElementById('testStatus').textContent = 'Initializing...';
    }

    async function runSpeedTest() {
        try {
            // Test ping first
            await testPing();
            
            // Test download speed
            await testDownloadSpeed();
            
            // Test upload speed
            await testUploadSpeed();
            
            // Show final results
            showFinalResults();
            
        } catch (error) {
            console.error('Speed test error:', error);
            document.getElementById('testStatus').textContent = 'Test failed. Please try again.';
        } finally {
            testInProgress = false;
            document.getElementById('startBtn').disabled = false;
        }
    }

    async function testPing() {
        document.getElementById('testStatus').textContent = 'Testing ping...';
        document.getElementById('progressBar').style.width = '10%';
        
        const startTime = performance.now();
        try {
            await fetch('https://www.google.com/favicon.ico', { 
                mode: 'no-cors',
                cache: 'no-cache'
            });
        } catch (e) {
            // Ignore CORS errors for ping test
        }
        const endTime = performance.now();
        
        pingTime = Math.round(endTime - startTime);
        await sleep(500);
    }

    async function testDownloadSpeed() {
        document.getElementById('testStatus').textContent = 'Testing download speed...';
        document.getElementById('progressBar').style.width = '30%';
        
        const testData = generateTestData(10 * 1024 * 1024); // 10MB
        const startTime = performance.now();
        
        // Simulate download by processing data
        await simulateDownload(testData);
        
        const endTime = performance.now();
        const duration = (endTime - startTime) / 1000; // seconds
        downloadSpeed = Math.round((testData.length / (1024 * 1024)) / duration * 8); // Mbps
        
        document.getElementById('downloadSpeed').textContent = downloadSpeed;
        document.getElementById('progressBar').style.width = '60%';
        await sleep(1000);
    }

    async function testUploadSpeed() {
        document.getElementById('testStatus').textContent = 'Testing upload speed...';
        document.getElementById('progressBar').style.width = '80%';
        
        const testData = generateTestData(5 * 1024 * 1024); // 5MB
        const startTime = performance.now();
        
        // Simulate upload by processing data
        await simulateUpload(testData);
        
        const endTime = performance.now();
        const duration = (endTime - startTime) / 1000; // seconds
        uploadSpeed = Math.round((testData.length / (1024 * 1024)) / duration * 8); // Mbps
        
        document.getElementById('uploadSpeed').textContent = uploadSpeed;
        document.getElementById('progressBar').style.width = '100%';
        document.getElementById('testStatus').textContent = 'Test completed!';
        await sleep(500);
    }

    function generateTestData(size) {
        const data = new Uint8Array(size);
        for (let i = 0; i < size; i++) {
            data[i] = Math.random() * 256;
        }
        return data;
    }

    async function simulateDownload(data) {
        // Simulate network processing time
        const chunks = 100;
        const chunkSize = Math.floor(data.length / chunks);
        
        for (let i = 0; i < chunks; i++) {
            await sleep(10); // Simulate network delay
            const progress = 30 + (i / chunks) * 30;
            document.getElementById('progressBar').style.width = progress + '%';
        }
    }

    async function simulateUpload(data) {
        // Simulate network processing time
        const chunks = 50;
        const chunkSize = Math.floor(data.length / chunks);
        
        for (let i = 0; i < chunks; i++) {
            await sleep(20); // Simulate network delay
            const progress = 60 + (i / chunks) * 20;
            document.getElementById('progressBar').style.width = progress + '%';
        }
    }

    function showFinalResults() {
        document.getElementById('finalDownload').textContent = downloadSpeed;
        document.getElementById('finalUpload').textContent = uploadSpeed;
        document.getElementById('pingResult').textContent = pingTime;
        document.getElementById('resultsSection').style.display = 'block';
    }

    function sleep(ms) {
        return new Promise(resolve => setTimeout(resolve, ms));
    }
  </script>
</body>
</html>
